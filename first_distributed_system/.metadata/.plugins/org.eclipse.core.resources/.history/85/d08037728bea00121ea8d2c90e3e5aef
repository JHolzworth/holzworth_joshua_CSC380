package Client;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.PrintWriter;
import java.net.Socket;
import java.net.UnknownHostException;
import java.util.Scanner;
import java.util.regex.Pattern;

public class ClientApplication {

	
	Socket clientSocket;
	
	public ClientApplication(String host, int port) throws UnknownHostException, IOException{
		clientSocket = new Socket(host,port);
		
	}
	
	
	private String getClientRequest(){

		Scanner clientInput = new Scanner(System.in);
		
		String firstLine = clientInput.nextLine();
		
		firstLine.replace(" ", "\n");
		
		Pattern pattern = Pattern.compile("(.+)+");
		
		String request = clientInput.next();
		
		while(clientInput.hasNext()){
			String input = clientInput.next();
			if(!input.equals("QUIT")){
				request+=" "+input;
			}
			else
				break;
		}
		
		
		request+=" "+clientInput.nextInt();
		request+=" "+clientInput.nextInt();
		return request;
	}
	
	public void start() throws IOException{
		System.out.println("Client Socket created");
		
		

		InputStream input = clientSocket.getInputStream();
		Scanner clientInput = new Scanner(input);
		System.out.println("Obtaining instructions");
		String options = "";
		options = clientInput.nextLine();
		System.out.println("Type the method name followed by a list of space delimated parameters. Hit enter when you are finished with the parameter list. \nPossible options:"+options);
		
		//SendingRequest
		OutputStream output = clientSocket.getOutputStream();
		PrintWriter writer = new PrintWriter(output);
		writer.write(getClientRequest());
		
		writer.flush();
		clientSocket.shutdownOutput();
		
		
		//Getting response
		
		String response = "";
		while(clientInput.hasNext()){
			response+=clientInput.nextLine();
		}
		
		System.out.println(response);
		
		//Delete when finished closes socket
		clientSocket.close();
	}
}
